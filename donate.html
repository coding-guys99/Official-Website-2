<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title data-i18n="donate.meta.title">Support KeySearch — Donate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Support KeySearch development. Choose your currency and amount, pay with PayPal or Stripe. Thank you for helping us stay fast and focused."/>
  <!-- 全局樣式（沿用專案） -->
  <link rel="stylesheet" href="css/styles.css"/>
  <link rel="stylesheet" href="css/app.css"/>
  <link rel="stylesheet" href="css/responsive.css"/>
  <style>
    /* ===== Donate page (black-gold single column) ===== */
    :root{
      /* 若專案已有設計變數就會覆蓋這些；以下僅作保底 */
      --ks-bg: var(--bg, #0f1115);
      --ks-card: var(--card, #171a21);
      --ks-text: var(--text, #e7ecf3);
      --ks-muted: var(--muted, #99a2b2);
      --ks-border: var(--border, #262b36);
      --ks-accent: var(--accent, #6ee7ff);
      --ks-accent2: var(--accent-2, #86efac);
      --ks-radius: var(--radius, 12px);
      --gold: #d3b36b;
    }
    body{ background: var(--ks-bg); color: var(--ks-text); }

    /* Mini header（無全站選單時的返回入口） */
    .mini-header{
      position: sticky; top: 0; z-index: 10;
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 16px; border-bottom: 1px solid var(--ks-border);
      background: linear-gradient(180deg, rgba(211,179,107,0.06), rgba(0,0,0,0)) ;
      backdrop-filter: saturate(120%) blur(6px);
    }
    .mini-header .brand{
      display:flex; align-items:center; gap:10px; color:var(--ks-text); text-decoration:none;
      font-weight:600;
    }
    .mini-header .back{
      color:var(--ks-muted); text-decoration:none; font-size:.95rem;
      border:1px solid var(--ks-border); padding:6px 10px; border-radius:999px;
    }
    .mini-header .back:hover{ border-color:var(--gold); color:var(--gold); }

    /* Hero */
    .donate-hero{
      padding: 56px 0 24px;
      background:
        radial-gradient(1200px 500px at 50% -80px, rgba(211,179,107,.12), rgba(0,0,0,0)),
        linear-gradient(180deg, rgba(211,179,107,.05), rgba(0,0,0,0));
      text-align:center;
    }
    .donate-hero .container{ max-width: 900px; margin: 0 auto; padding: 0 16px; }
    .donate-hero h1{ margin: 0 0 10px; letter-spacing:.2px; }
    .donate-hero p{ margin: 0; color: var(--ks-muted); }

    /* Center card */
    .donate-wrap{ padding: 20px 16px 8px; }
    .donate-card{
      max-width: 720px; margin: 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--ks-card);
      border: 1px solid var(--ks-border); border-radius: calc(var(--ks-radius) + 4px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      padding: 24px;
    }
    .donate-card h2{ margin: 0 0 6px; }
    .donate-card .fine-print{ color: var(--ks-muted); font-size: .95rem; }

    /* Controls */
    .donate-controls{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin: 14px 0 10px; }
    .donate-controls label span{ color: var(--ks-muted); margin-right: 6px; }

    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{
      border:1px solid var(--ks-border); background:transparent; color:var(--ks-text);
      padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:600;
      transition: border-color .2s, box-shadow .2s, transform .02s;
    }
    .chip:hover{ border-color: var(--gold); box-shadow: 0 0 0 3px rgba(211,179,107,.12) inset; }
    .chip.active{ border-color: var(--gold); box-shadow: 0 0 0 2px rgba(211,179,107,.24) inset; }
    .donate-custom{ width: 140px; background: transparent; border:1px solid var(--ks-border); color: var(--ks-text);
      border-radius: 10px; padding: 10px 12px; }

    /* Buttons */
    .donate-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .btn-primary{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 16px; border-radius: 10px; text-decoration:none; font-weight:700;
      border:1px solid transparent;
    }
    .btn-paypal{ background:#0070ba; color:#fff; }
    .btn-paypal:hover{ filter:brightness(1.08); }
    .btn-stripe{ background:#635bff; color:#fff; }
    .btn-stripe:hover{ filter:brightness(1.08); }
    .btn-ghost{ border-color: var(--ks-border); color: var(--ks-text); }
    .btn-ghost:hover{ border-color: var(--gold); color: var(--gold); }

    /* Divider & List */
    .divider{ height:1px; background: var(--ks-border); margin: 18px 0; }
    .list{ margin:0; padding-left: 18px; }

    /* FAQ */
    .faq{ max-width: 820px; margin: 24px auto 56px; padding: 0 16px; }
    .faq h3{ margin: 0 0 8px; }
    .faq details{ border:1px solid var(--ks-border); border-radius: 10px; padding: 10px 14px; margin: 10px 0; background: var(--ks-card); }
    .faq summary{ cursor: pointer; font-weight:600; }
    .faq .fine-print{ color: var(--ks-muted); margin-top: 8px; }

    @media (max-width: 560px){
      .donate-custom{ width: 110px; }
    }
  </style>
</head>
<body>

  <!-- Mini header（無全站選單時） -->
  <header class="mini-header" role="banner">
    <a class="brand" href="index.html" aria-label="KeySearch home">
      <img src="assets/logo.svg" alt="KeySearch logo" width="24" height="24"/>
      <span>KeySearch</span>
    </a>
    <a class="back" href="support.html" aria-label="Back to Support">← Back</a>
  </header>

  <!-- Hero -->
  <section class="donate-hero">
    <div class="container">
      <h1 data-i18n="donate.title">Support development</h1>
      <p data-i18n="donate.subtitle">KeySearch is free. If it saves you time, consider supporting the project.</p>
    </div>
  </section>

  <!-- Centered Card -->
  <main class="donate-wrap">
    <section class="donate-card" role="region" aria-labelledby="donateHeading">
      <h2 id="donateHeading" data-i18n="donate.card.title">Donate</h2>
      <p class="fine-print" data-i18n="donate.card.desc">Choose your currency and amount. Then pick PayPal or Stripe to complete payment.</p>

      <!-- Controls -->
      <div class="donate-controls">
        <label>
          <span data-i18n="donate.currency">Currency</span>
          <select id="donate-currency" aria-label="Choose currency">
            <option value="USD" selected>USD $</option>
            <option value="TWD">TWD NT$</option>
            <option value="MYR">MYR RM</option>
          </select>
        </label>

        <div class="chips" id="chips">
          <button class="chip" data-base-usd="5">$5</button>
          <button class="chip" data-base-usd="10">$10</button>
          <button class="chip" data-base-usd="20">$20</button>
          <button class="chip" data-base-usd="50">$50</button>
          <input id="donate-custom" class="donate-custom" type="number" min="1" step="1" placeholder="Custom" aria-label="Custom amount">
        </div>
      </div>

      <!-- Actions -->
      <div class="donate-actions">
        <a id="btn-paypal" class="btn-primary btn-paypal" href="https://paypal.me/AndyWongChernInn" target="_blank" rel="noopener" data-i18n="donate.paypal">Pay with PayPal</a>
        <a id="btn-stripe" class="btn-primary btn-stripe" href="https://buy.stripe.com/your_usd_fallback" target="_blank" rel="noopener" data-i18n="donate.stripe">Pay with Stripe</a>
        <a id="btn-coffee" class="btn-ghost btn-primary" href="https://www.buymeacoffee.com/yourid" target="_blank" rel="noopener" data-i18n="donate.coffee">Buy me a coffee</a>
      </div>

      <div class="divider"></div>

      <ul class="list">
        <li data-i18n="donate.uses.1">Funds cover hosting, storage, testing devices, and development time.</li>
        <li data-i18n="donate.uses.2">Roadmap priorities: performance, multi-language, desktop packaging, and licensing.</li>
      </ul>

      <p class="fine-print" data-i18n="donate.thanks">Thanks for your support — it keeps KeySearch fast and focused.</p>
    </section>

    <!-- FAQ -->
    <section class="faq" aria-label="Donate FAQ">
      <h3 data-i18n="donate.faq.title">FAQ</h3>
      <details>
        <summary data-i18n="donate.faq.q1">Can I get a receipt?</summary>
        <div class="fine-print" data-i18n="donate.faq.a1">Yes. PayPal/Stripe emails a receipt automatically after payment.</div>
      </details>
      <details>
        <summary data-i18n="donate.faq.q2">Which currency will I be charged in?</summary>
        <div class="fine-print" data-i18n="donate.faq.a2">PayPal uses your account currency; Stripe uses the currency shown on the checkout page.</div>
      </details>
      <details>
        <summary data-i18n="donate.faq.q3">Refunds?</summary>
        <div class="fine-print" data-i18n="donate.faq.a3">Donations are voluntary and typically non-refundable. If there’s an issue, contact us.</div>
      </details>
      <details>
        <summary data-i18n="donate.faq.q4">Is there a subscription?</summary>
        <div class="fine-print" data-i18n="donate.faq.a4">For now donations are one-time. Subscriptions may be added later.</div>
      </details>
    </section>
  </main>

  <script>
  (function(){
    // ====== PayPal.me（你的 ID 已填好）======
    const PAYPAL_ME_BASE = 'https://paypal.me/AndyWongChernInn';

    // ====== Stripe Payment Links（請替換為你的）======
    // 結構：STRIPE_LINKS[幣別].byAmount[金額]；沒有精準金額時 fallback。
    const STRIPE_LINKS = {
      USD: {
        fallback: 'https://buy.stripe.com/your_usd_fallback',
        byAmount: {
          5:  'https://buy.stripe.com/usd_5_link',
          10: 'https://buy.stripe.com/usd_10_link',
          20: 'https://buy.stripe.com/usd_20_link',
          50: 'https://buy.stripe.com/usd_50_link'
        }
      },
      TWD: {
        fallback: 'https://buy.stripe.com/your_twd_fallback',
        byAmount: {
          160: 'https://buy.stripe.com/twd_160_link',
          320: 'https://buy.stripe.com/twd_320_link',
          640: 'https://buy.stripe.com/twd_640_link',
          1600:'https://buy.stripe.com/twd_1600_link'
        }
      },
      MYR: {
        fallback: 'https://buy.stripe.com/your_myr_fallback',
        byAmount: {
          24: 'https://buy.stripe.com/myr_24_link',
          48: 'https://buy.stripe.com/myr_48_link',
          96: 'https://buy.stripe.com/myr_96_link',
          240:'https://buy.stripe.com/myr_240_link'
        }
      }
    };

    // 粗略換算（僅用於顯示 chip 標籤）
    const RATE = { USD_TWD: 32, USD_MYR: 4.8 };

    const selCcy = document.getElementById('donate-currency');
    const chips  = Array.from(document.querySelectorAll('.chip'));
    const input  = document.getElementById('donate-custom');
    const btnPP  = document.getElementById('btn-paypal');
    const btnSt  = document.getElementById('btn-stripe');

    const fmt = (ccy, val) => ({USD:'$',TWD:'NT$',MYR:'RM'}[ccy]||'$') + val;

    // 將 chip 以 base USD 換算成當地幣別顯示
    function renderChips(ccy){
      chips.forEach(ch=>{
        const usd = Number(ch.dataset.baseUsd);
        const val = (ccy==='TWD')? Math.round(usd*RATE.USD_TWD)
                  : (ccy==='MYR')? Math.round(usd*RATE.USD_MYR)
                  : usd;
        ch.dataset.amt = String(val);
        ch.textContent = fmt(ccy, val);
      });
    }

    function setActiveChipByAmt(amt){
      chips.forEach(c => c.classList.toggle('active', Number(c.dataset.amt)===Number(amt)));
    }

    function stripeLink(ccy, amt){
      const cfg = STRIPE_LINKS[ccy] || STRIPE_LINKS.USD;
      return cfg.byAmount[String(amt)] || cfg.fallback;
    }

    function updateLinks(){
      const ccy = selCcy.value;
      const amt = current.amount;
      btnPP.href = amt ? `${PAYPAL_ME_BASE}/${amt}` : PAYPAL_ME_BASE;
      btnSt.href = stripeLink(ccy, amt);
    }

    function withUtm(href, method, ccy, amt){
      try{
        const u = new URL(href);
        u.searchParams.set('utm_source','site');
        u.searchParams.set('utm_campaign','donate');
        u.searchParams.set('method', method);
        u.searchParams.set('ccy', ccy);
        u.searchParams.set('amt', amt);
        return u.toString();
      }catch{ return href; }
    }

    // 狀態
    const current = { currency: selCcy.value, amount: 5 };

    // 初始化
    renderChips(current.currency);
    setActiveChipByAmt(current.amount);
    updateLinks();

    // 事件
    selCcy.addEventListener('change', ()=>{
      current.currency = selCcy.value;
      renderChips(current.currency);
      // 預設選第一顆 chip（5 USD 等值）
      const first = chips[0];
      current.amount = Number(first.dataset.amt);
      setActiveChipByAmt(current.amount);
      input.value = '';
      updateLinks();
    });

    chips.forEach(ch=>{
      ch.addEventListener('click', ()=>{
        current.amount = Number(ch.dataset.amt);
        input.value = '';
        setActiveChipByAmt(current.amount);
        updateLinks();
      });
    });

    input.addEventListener('input', ()=>{
      const v = Math.max(1, Math.floor(Number(input.value)||0));
      current.amount = v;
      setActiveChipByAmt(null);
      updateLinks();
    });

    // 付款按鈕加 UTM
    btnPP.addEventListener('click', ()=>{
      btnPP.href = withUtm(btnPP.href, 'paypal', current.currency, current.amount);
    });
    btnSt.addEventListener('click', ()=>{
      btnSt.href = withUtm(btnSt.href, 'stripe', current.currency, current.amount);
    });

    // URL 參數：?ccy=USD&amt=10
    (function applyUrlParams(){
      const p = new URLSearchParams(location.search);
      const c = (p.get('ccy')||'').toUpperCase();
      const a = Number(p.get('amt')||'');
      if (c && ['USD','TWD','MYR'].includes(c)){
        selCcy.value = c;
        current.currency = c;
        renderChips(c);
      }
      if (!Number.isNaN(a) && a>0){
        current.amount = a;
        input.value = '';
        setActiveChipByAmt(a);
      }else{
        // 如果沒有傳 amt，用第一顆 chip
        const first = chips[0];
        current.amount = Number(first.dataset.amt);
        setActiveChipByAmt(current.amount);
      }
      updateLinks();
    })();
  })();
  </script>
</body>
</html>